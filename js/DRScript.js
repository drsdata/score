DRScript=new function(){this.parse=function(e){function t(){this.measure=0,this.point=0,this.type=0,this.start=0,this.end=0,this.group=0,this.time=0}function a(){this.value=0,this.measure=0,this.point=0,this.time=0}function i(){this.valueS=0,this.valueB=0,this.measure=0,this.time=0}function s(e){for(var t={valueS:4,valueB:4,measure:e},a=0;a<l.measure.length&&e<l.measure[a].measure;a++)t.valueS=l.measure[a].valueS,t.valueB=l.measure[a].valueB,t.measure=l.measure[a].measure;return t}var l={};l.title="",l.sound="",l.offset=0,l.level=0,l.combo=0,l.endTime=0,l.endMeasure=0,l.endBeat=0,l.minBpm=0,l.maxBpm=0,l.type="all",l.difficulty=0,l.obj=[],l.bpm=[],l.measure=[],l.newLine=[];var n=new i;n.valueS=4,n.valueB=4,n.measure=1,n.time=0,l.measure.push(n);var u=e.split(/\r\n|\r|\n/g);for(var r in u){var m=u[r];if(-1!==m.indexOf("//")&&(m=m.substring(0,m.indexOf("//"))),0!==m.length)if("#"===m.charAt(0)){if(null!==m.match(/^#TITLE:/i))l.title=m.slice("#TITLE:".length);else if(null!==m.match(/^#LEVEL:/i))l.level=parseInt(m.slice("#LEVEL:".length));else if(null!==m.match(/^#BPM:/i)){var h=m.slice("#BPM:".length).match(/(\d+)\s*,\s*([\d\.]+)\s*,\s*([\d\.]+)/);if(null!==h){var p=new a;p.measure=parseFloat(h[1]),p.point=parseFloat(h[2]),p.value=parseFloat(h[3]),l.bpm.push(p)}}else if(null!==m.match(/^#TYPE:/i)){var c=m.slice("#TYPE:".length);c.match(/CU/i)?l.type="cu":c.match(/CO/i)?l.type="co":c.match(/PA/i)?l.type="pa":l.type="all"}else if(null!==m.match(/^#MEASURE:/i)){var f=m.slice("#MEASURE:".length).match(/(\d+)\s*,\s*(\d+),\s*(\d+)/);if(null!==f){var o=new i;o.measure=parseFloat(f[1]),o.valueS=parseFloat(f[2]),o.valueB=parseFloat(f[3]),o.time=0,l.measure.push(o)}}else if(null!==m.match(/^#NEWLINE:/i)){var v=m.slice("#NEWLINE:".length).match(/(\d+)/);null!==v&&l.newLine.push(parseInt(v[1]))}else if(null!==m.match(/^#DIFFICULTY:/i)){var f=m.slice("#DIFFICULTY:".length);f.match(/\s*MASTER\+\s*/i)?l.difficulty=4:f.match(/\s*MASTER\s*/i)?l.difficulty=3:f.match(/\s*PRO\s*/i)?l.difficulty=2:f.match(/\s*REGULAR\s*/i)?l.difficulty=1:f.match(/\s*DEBUT\s*/i)?l.difficulty=0:(l.difficulty=parseInt(f),0===l.difficulty||l.difficulty||(l.difficulty=0))}}else{var d=m.split(/,/g);if(6===d.length){var E=new t;E.measure=parseInt(d[0]),E.point=parseFloat(d[1]),E.type=parseInt(d[2]),E.start=parseInt(d[3]),E.end=parseInt(d[4]),E.group=parseInt(d[5]),l.obj.push(E)}}}l.obj.sort(function(e,t){return e.measure!==t.measure?e.measure-t.measure:e.point-t.point}),l.endTime=l.obj[l.obj.length-1].time+1e3,l.endMeasure=function(){var e=1;for(var t in l.obj)e<l.obj[t].measure&&(e=l.obj[t].measure);return e}(),l.endBeat=function(e){for(var t=0,a=1;e>=a;a++){var i=s(a);t+=i.valueS/i.valueB*4}return t}(l.endMeasure);var y=function(){var e=[];for(var t in l.bpm)e.push(l.bpm[t].value);return e}();return l.maxBpm=Math.max.apply(null,y),l.minBpm=Math.min.apply(null,y),l.combo=l.obj.length,l}};